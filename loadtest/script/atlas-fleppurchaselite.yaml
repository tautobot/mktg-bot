# docstring
  # TARGET=http://34.87.96.34:21060  DURATION=10      ARRIVAL_COUNT=100   artillery run atlas-fleppurchaselite.yaml   | tee ../log_vault/atlas-fleppurchaselite-d10ac100.`date +%Y%m%d_%H%M%S`.log
  #        #aQA home url           #in 100 seconds  #run 1000 users                   #loadtest script                #log saved to file

config:
  target: "{{ $processEnvironment.TARGET }}"

  phases:
  - duration     : "{{ $processEnvironment.DURATION }}"
    arrivalCount : "{{ $processEnvironment.ARRIVAL_COUNT }}"


  # set request header
  defaults:
    header:
      Content-Type: "application/json"

  # define randomUser() that defines :email_suffix and :nricfin variable
  processor: "./prepare-data.js"

scenarios:
- name: "Test :atlas load via flep-purchase endpoint /loadtests/lt200218"

  flow:
  # call randomUser() declared in prepare-data.js above that creates :email_suffix and :nricfin variable
  - function: "randomUser"

  # make request to the endpoint ie POST /loadtests/lt200218 json_input ...
  - post:
      url: "/loadtests/lt200218"
      json:
        payment:
          card:
            token: "tok_sg"
            provider: "stripe"
        underwriting:
          plan: "flep80"
          product: "flep"
          unit: "monthly"
          policy_start: "2019-04-10"
          dob: "1990-07-31"
          occupations: "Sales"
          outdoor: "false"
          manual: "false"
          motorbike: "false"
          premiums: 22.40
          refcode: ""
          email: "developers+{{email_suffix}}@gigacover.com"
          nricfin: "S{{nricfin}}A"
          first_name: "Duc"
          last_name: "Le"
          mobile: "+6591234568"
          postalcode: "456789"
          pdpa_consent: "true"
          marketing_consent: "true"
          underwriting_consent: "true"
